import{a as l,f as v,t as B}from"../chunks/YeIyPrO1.js";import"../chunks/JjcR20PN.js";import{o as ce}from"../chunks/7XJTIz-S.js";import{p as pe,a as de,b as r,s as n,c,g as e,r as s,m as f,n as E,t as k,i as ve,h as me}from"../chunks/B28Y1LK0.js";import{d as fe,s as q}from"../chunks/DrRmIrL_.js";import{i as I}from"../chunks/CSigMgDx.js";import{p as J,f as C,e as z,i as A}from"../chunks/BSTHbYmA.js";import{r as ue,B as O,s as _e,b as he}from"../chunks/CTMhrdmY.js";import{b as G}from"../chunks/BnWQKn17.js";import{i as ye}from"../chunks/B5oQgd4i.js";var ge=v('<p class="muted">Loading...</p>'),be=v('<p class="muted">No results yet.</p>'),xe=v("<li><p><strong> </strong></p> <p> </p></li>"),$e=v('<ul class="memory-results"></ul>'),we=v("<option> </option>"),Se=v('<div class="split-grid"><section class="panel"><h3>Search Memory</h3> <label for="query">Query</label> <input id="query" name="memory_query" type="text" autocomplete="off" placeholder="Search memory snippets..."/> <!> <!></section> <section class="panel"><h3>Curated Editor</h3> <label for="file-select">File</label> <select id="file-select" name="memory_file"></select> <label for="file-content">Content</label> <textarea id="file-content" name="memory_content"></textarea> <div class="inline"><!> <!></div></section></div>'),ke=v('<p class="error" aria-live="polite"> </p>'),qe=v('<section><header class="page-header"><p class="kicker">Knowledge</p> <h2>Memory</h2> <p class="muted">Search indexed memory and edit curated markdown files.</p></header> <!> <!></section>');function Oe(H,V){pe(V,!1);let F=f(!0),m=f(""),_=f([]),p=f(""),g=f(""),b="",x=f(""),$=f([]);async function W(){const t=await C("/api/manage/files");r(_,t.files||[]),!e(p)&&e(_).length>0&&(r(p,e(_)[0].id),await M())}async function M(){if(!e(p))return;const t=await C(`/api/manage/files?id=${e(p)}`);r(g,t.content||""),b=t.etag||""}async function X(){if(e(p)){r(m,"");try{b=(await C(`/api/manage/files/${e(p)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e(g),etag:b})})).etag||b}catch(t){r(m,J(t))}}}async function Y(){r(m,"");try{if(!e(x).trim()){r($,[]);return}const t=await C(`/api/manage/memory/search?q=${encodeURIComponent(e(x))}`);r($,t.results||[])}catch(t){r(m,J(t))}}ce(async()=>{r(F,!0);try{await W()}catch(t){r(m,J(t))}finally{r(F,!1)}}),ye();var P=qe(),T=n(c(P),2);{var Z=t=>{var d=ge();l(t,d)},ee=t=>{var d=Se(),h=c(d),N=n(c(h),4);ue(N);var U=n(N,2);O(U,{type:"button",onclick:Y,children:(a,i)=>{E();var o=B("Search");l(a,o)},$$slots:{default:!0}});var re=n(U,2);{var oe=a=>{var i=be();l(a,i)},se=a=>{var i=$e();z(i,5,()=>e($),A,(o,S)=>{var u=xe(),R=c(u),L=c(R),le=c(L,!0);s(L),s(R);var Q=n(R,2),ne=c(Q,!0);s(Q),s(u),k(()=>{q(le,e(S).path),q(ne,e(S).content)}),l(o,u)}),s(i),l(a,i)};I(re,a=>{e($).length===0?a(oe):a(se,!1)})}s(h);var j=n(h,2),y=n(c(j),4);k(()=>{e(p),ve(()=>{e(_)})}),y.__change=async()=>{await M()},z(y,5,()=>e(_),A,(a,i)=>{var o=we(),S=c(o,!0);s(o);var u={};k(()=>{q(S,e(i).label),u!==(u=e(i).id)&&(o.value=(o.__value=e(i).id)??"")}),l(a,o)}),s(y);var w=n(y,4);me(w),_e(w,"rows",18);var D=n(w,2),K=c(D);O(K,{type:"button",onclick:X,children:(a,i)=>{E();var o=B("Save");l(a,o)},$$slots:{default:!0}});var ie=n(K,2);O(ie,{type:"button",onclick:M,children:(a,i)=>{E();var o=B("Reload");l(a,o)},$$slots:{default:!0}}),s(D),s(j),s(d),G(N,()=>e(x),a=>r(x,a)),he(y,()=>e(p),a=>r(p,a)),G(w,()=>e(g),a=>r(g,a)),l(t,d)};I(T,t=>{e(F)?t(Z):t(ee,!1)})}var te=n(T,2);{var ae=t=>{var d=ke(),h=c(d,!0);s(d),k(()=>q(h,e(m))),l(t,d)};I(te,t=>{e(m)&&t(ae)})}s(P),l(H,P),de()}fe(["change"]);export{Oe as component};
