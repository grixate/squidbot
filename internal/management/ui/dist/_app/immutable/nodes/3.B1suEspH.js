import{a as c,f as P,t as D}from"../chunks/BEu3xU8X.js";import"../chunks/BKxQFQd5.js";import{o as ye}from"../chunks/Vc4QFieL.js";import{p as Se,l as oe,e as ke,t as G,a as Pe,b as t,g as a,c as s,s as n,r as i,m as l,n as A}from"../chunks/BTMJvSec.js";import{s as H}from"../chunks/Bcgy8Ni5.js";import{i as E}from"../chunks/CcCxq7f-.js";import{f as k,p as Te,r as g,B as Q}from"../chunks/C6q300kx.js";import{b as _}from"../chunks/l2SKR2qa.js";import{i as $e}from"../chunks/DlHN4S8Y.js";import{g as ne}from"../chunks/D9L8ZV2M.js";import{S as xe}from"../chunks/DWSVT9GM.js";import{S as Oe}from"../chunks/BNN7y7EJ.js";const Ce=!0,He=Object.freeze(Object.defineProperty({__proto__:null,prerender:Ce},Symbol.toStringTag,{value:"Module"}));var Be=P('<section class="panel"><p class="muted">Loading…</p></section>'),Me=P('<section class="panel"><h2>Onboarding</h2> <label for="provider">Provider</label> <!> <label for="api-key">API Key</label> <input id="api-key" name="api_key" type="password" autocomplete="off"/> <label for="api-base">API Base</label> <input id="api-base" name="api_base" type="text" autocomplete="off"/> <label for="model">Model</label> <input id="model" name="model" type="text" autocomplete="off"/> <div class="inline"><!> <span class="result"> </span></div> <hr/> <div class="checkbox"><!> <span>Enable Telegram Channel</span></div> <label for="telegram-token">Telegram Token</label> <input id="telegram-token" name="telegram_token" type="password" autocomplete="off"/> <label for="telegram-allow">Telegram Allow List</label> <input id="telegram-allow" name="telegram_allow" type="text" autocomplete="off"/> <hr/> <label for="password">Management Password (min 12 chars)</label> <input id="password" name="password" type="password" autocomplete="new-password"/> <!></section>'),Le=P('<section class="panel"><h2>Sign In</h2> <label for="login-password">Password</label> <input id="login-password" name="login_password" type="password" autocomplete="current-password"/> <!></section>'),je=P('<p class="error" aria-live="polite"> </p>'),Ae=P('<main class="onboarding-shell"><header class="page-header"><p class="kicker">Squidbot</p> <h1>Mission Control Setup</h1> <p class="muted"> </p></header> <!> <!> <!> <!></main>');function Qe(le,se){Se(se,!1);let u=l("loading"),K=l("Loading setup state…"),b=l(""),T="",h=l([]),p=l(""),$=l(""),m=l(""),f=l(""),x=l(""),w=l(""),O=l(!1),N=l(""),C=l(""),B=l(""),V=l([]);const M=()=>t(b,""),L=e=>{t(b,Te(e))};function W(){const e=a(h).find(r=>r.id===a(p));e&&(!a(m)&&e.defaultApiBase&&t(m,e.defaultApiBase),!a(f)&&e.defaultModel&&t(f,e.defaultModel))}async function X(){M(),t(u,"loading");const e=await k("/api/setup/state");if(t(h,e.providers||[]),t(p,e.current?.provider?.id||a(h)[0]?.id||""),t(m,e.current?.provider?.apiBase||""),t(f,e.current?.provider?.model||""),t(O,!!e.current?.channels?.telegram?.enabled),t(C,(e.current?.channels?.telegram?.allowFrom||[]).join(",")),W(),!e.setupComplete){t(u,"onboarding"),t(K,"Complete onboarding to unlock Mission Control.");return}if((await k("/api/auth/session")).authenticated){await ne("/app/mission-control");return}t(u,"login"),t(K,"Setup complete. Sign in to continue.")}async function ie(){M(),t(w,"Testing…");try{const e=await k("/api/setup/provider/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:T,provider:a(p),apiKey:a($),apiBase:a(m),model:a(f)})});if(e.ok){t(w,"OK");return}t(w,"Failed"),t(b,e.error||"Provider test failed")}catch(e){t(w,"Failed"),L(e)}}async function pe(){M();try{await k("/api/setup/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:T,provider:a(p),apiKey:a($),apiBase:a(m),model:a(f),channel:{id:"telegram",enabled:a(O),token:a(N),allowFrom:a(C).split(",").map(r=>r.trim()).filter(r=>r.length>0)},password:a(x)})});const e=new URL(window.location.href);e.searchParams.delete("setup_token"),window.history.replaceState({},"",e.toString()),T="",t(x,""),await X()}catch(e){L(e)}}async function de(){M();try{await k("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a(B)})}),t(B,""),await ne("/app/mission-control")}catch(e){L(e)}}ye(async()=>{T=new URLSearchParams(window.location.search).get("setup_token")||"";try{await X()}catch(e){L(e),t(u,"loading")}}),oe(()=>a(h),()=>{t(V,a(h).map(e=>({value:e.id,label:e.label})))}),oe(()=>a(p),()=>{a(p)&&W()}),ke(),$e();var F=Ae(),I=s(F),Y=n(s(I),4),ce=s(Y,!0);i(Y),i(I);var Z=n(I,2);{var ue=e=>{var r=Be();c(e,r)};E(Z,e=>{a(u)==="loading"&&e(ue)})}var ee=n(Z,2);{var me=e=>{var r=Me(),d=n(s(r),4);xe(d,{id:"provider",name:"provider",get options(){return a(V)},ariaLabel:"Provider",placeholder:"Select provider…",get value(){return a(p)},set value(o){t(p,o)},$$legacy:!0});var y=n(d,4);g(y);var v=n(y,4);g(v);var j=n(v,4);g(j);var S=n(j,2),te=s(S);Q(te,{type:"button",onclick:ie,children:(o,we)=>{A();var z=D("Test Connection");c(o,z)},$$slots:{default:!0}});var re=n(te,2),_e=s(re,!0);i(re),i(S);var J=n(S,4),be=s(J);Oe(be,{ariaLabel:"Enable Telegram Channel",get checked(){return a(O)},set checked(o){t(O,o)},$$legacy:!0}),A(2),i(J);var R=n(J,4);g(R);var U=n(R,4);g(U);var q=n(U,6);g(q);var he=n(q,2);Q(he,{type:"button",onclick:pe,children:(o,we)=>{A();var z=D("Complete Setup");c(o,z)},$$slots:{default:!0}}),i(r),G(()=>H(_e,a(w))),_(y,()=>a($),o=>t($,o)),_(v,()=>a(m),o=>t(m,o)),_(j,()=>a(f),o=>t(f,o)),_(R,()=>a(N),o=>t(N,o)),_(U,()=>a(C),o=>t(C,o)),_(q,()=>a(x),o=>t(x,o)),c(e,r)};E(ee,e=>{a(u)==="onboarding"&&e(me)})}var ae=n(ee,2);{var fe=e=>{var r=Le(),d=n(s(r),4);g(d);var y=n(d,2);Q(y,{type:"button",onclick:de,children:(v,j)=>{A();var S=D("Sign In");c(v,S)},$$slots:{default:!0}}),i(r),_(d,()=>a(B),v=>t(B,v)),c(e,r)};E(ae,e=>{a(u)==="login"&&e(fe)})}var ve=n(ae,2);{var ge=e=>{var r=je(),d=s(r,!0);i(r),G(()=>H(d,a(b))),c(e,r)};E(ve,e=>{a(b)&&e(ge)})}i(F),G(()=>H(ce,a(K))),c(le,F),Pe()}export{Qe as component,He as universal};
