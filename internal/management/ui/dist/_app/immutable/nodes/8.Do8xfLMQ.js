import{a as p,f as g,t as L}from"../chunks/YeIyPrO1.js";import"../chunks/JjcR20PN.js";import{o as at}from"../chunks/7XJTIz-S.js";import{p as tt,a as et,s as t,c as r,g as a,r as e,b as o,m as h,f as rt,h as st,t as x,i as it,n as N,e as Pa}from"../chunks/B28Y1LK0.js";import{s as n,e as oa}from"../chunks/DrRmIrL_.js";import{i as na}from"../chunks/CSigMgDx.js";import{f as S,p as R,e as Sa,i as Da}from"../chunks/BSTHbYmA.js";import{r as ot,s as nt,B,b as lt}from"../chunks/CTMhrdmY.js";import{b as Ia}from"../chunks/BnWQKn17.js";import{i as ct}from"../chunks/B5oQgd4i.js";var pt=g('<p class="muted">Loading...</p>'),vt=g("<p> </p>"),dt=g('<article class="task-card" draggable="true"><h4> </h4> <!> <div class="task-meta"><span> </span> <span> </span></div> <div class="task-actions"><!> <!> <!></div></article>'),ut=g('<article class="panel kanban-col"><header><h3> </h3> <p class="muted"> </p></header> <div class="kanban-list"></div></article>'),_t=g('<div class="stat-grid"><article class="panel stat-card"><h3>Agent State</h3> <p class="stat-value"> </p> <p class="muted"> </p></article> <article class="panel stat-card"><h3>Active Work</h3> <p class="stat-value"> </p> <p class="muted"> </p></article> <article class="panel stat-card"><h3>Open Tasks</h3> <p class="stat-value"> </p> <p class="muted"> </p></article> <article class="panel stat-card"><h3>Token Usage</h3> <p class="stat-value"> </p> <p class="muted"> </p></article></div> <section class="panel task-form"><h3>Add Task to Backlog</h3> <label for="task-title">Title</label> <input id="task-title" name="task_title" type="text" autocomplete="off"/> <label for="task-desc">Description</label> <textarea id="task-desc" name="task_description"></textarea> <label for="task-priority">Priority</label> <select id="task-priority" name="task_priority"><option>None</option><option>Critical</option><option>High</option><option>Medium</option><option>Low</option></select> <!></section> <section class="kanban"></section>',1),mt=g('<p class="error" aria-live="polite"> </p>'),ft=g('<section><header class="page-header"><p class="kicker">Dashboard</p> <h2>Mission Control</h2> <p class="muted">Live state, usage, and board operations.</p></header> <!> <!></section>');function St(Oa,Ca){tt(Ca,!1);let J=h(!0),u=h(""),v=h(null),k=h([]),la=[],$=h(""),D=h(""),T=h(""),I=h("");const O=async()=>{o(J,!0),o(u,"");try{const[s,i]=await Promise.all([S("/api/manage/overview"),S("/api/manage/kanban")]);o(v,s),o(k,i.columns||[]),la=i.tasks||[]}catch(s){o(u,R(s))}finally{o(J,!1)}},C=s=>la.filter(i=>i.column_id===s).sort((i,l)=>i.position-l.position);async function Ma(){if(!a($).trim()){o(u,"Task title is required.");return}o(u,"");try{await S("/api/manage/kanban/tasks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:a($),description:a(D),priority:a(T),columnId:"backlog",source:{type:"manual"},dedupe:!1})}),o($,""),o(D,""),o(T,""),await O()}catch(s){o(u,R(s))}}async function ca(s,i,l){try{await S(`/api/manage/kanban/tasks/${s}/move`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({columnId:i,position:l})}),await O()}catch(d){o(u,R(d))}}async function Aa(s){try{await S(`/api/manage/kanban/tasks/${s}`,{method:"DELETE"}),await O()}catch(i){o(u,R(i))}}const W=s=>a(k).findIndex(i=>i.id===s);async function pa(s,i){const l=W(s.column_id);if(l<0)return;const d=l+i;d<0||d>=a(k).length||await ca(s.id,a(k)[d].id,C(a(k)[d].id).length)}at(async()=>{await O()}),ct();var j=ft(),va=t(r(j),2);{var Ea=s=>{var i=pt();p(s,i)},La=s=>{var i=_t(),l=rt(i),d=r(l),q=t(r(d),2),Ba=r(q,!0);e(q);var da=t(q,2),Ja=r(da,!0);e(da),e(d);var F=t(d,2),H=t(r(F),2),Wa=r(H,!0);e(H);var ua=t(H,2),ja=r(ua);e(ua),e(F);var U=t(F,2),z=t(r(U),2),qa=r(z,!0);e(z);var _a=t(z,2),Fa=r(_a);e(_a),e(U);var ma=t(U,2),G=t(r(ma),2),Ha=r(G,!0);e(G);var fa=t(G,2),Ua=r(fa);e(fa),e(ma),e(l);var K=t(l,2),Q=t(r(K),4);ot(Q);var M=t(Q,4);st(M),nt(M,"rows",2);var A=t(M,4);x(()=>{a(T),it(()=>{})});var V=r(A);V.value=V.__value="";var X=t(V);X.value=X.__value="critical";var Y=t(X);Y.value=Y.__value="high";var Z=t(Y);Z.value=Z.__value="medium";var ha=t(Z);ha.value=ha.__value="low",e(A);var za=t(A,2);B(za,{type:"button",onclick:Ma,children:(_,y)=>{N();var b=L("Create Task");p(_,b)},$$slots:{default:!0}}),e(K);var ka=t(K,2);Sa(ka,5,()=>a(k),Da,(_,y)=>{var b=ut(),aa=r(b),ta=r(aa),Ga=r(ta,!0);e(ta);var ba=t(ta,2),Ka=r(ba);e(ba),e(aa);var ga=t(aa,2);Sa(ga,5,()=>C(a(y).id),Da,(w,c)=>{var E=dt(),ea=r(E),Qa=r(ea,!0);e(ea);var ya=t(ea,2);{var Va=m=>{var f=vt(),P=r(f,!0);e(f),x(()=>n(P,a(c).description)),p(m,f)};na(ya,m=>{a(c).description&&m(Va)})}var ra=t(ya,2),sa=r(ra),Xa=r(sa,!0);e(sa);var xa=t(sa,2),Ya=r(xa,!0);e(xa),e(ra);var $a=t(ra,2),Ta=r($a);{let m=Pa(()=>W(a(c).column_id)<=0);B(Ta,{type:"button","aria-label":"Move task left",get disabled(){return a(m)},onclick:()=>pa(a(c),-1),children:(f,P)=>{N();var ia=L("<-");p(f,ia)},$$slots:{default:!0}})}var wa=t(Ta,2);{let m=Pa(()=>W(a(c).column_id)>=a(k).length-1);B(wa,{type:"button","aria-label":"Move task right",get disabled(){return a(m)},onclick:()=>pa(a(c),1),children:(f,P)=>{N();var ia=L("->");p(f,ia)},$$slots:{default:!0}})}var Za=t(wa,2);B(Za,{type:"button",onclick:()=>Aa(a(c).id),children:(m,f)=>{N();var P=L("Delete");p(m,P)},$$slots:{default:!0}}),e($a),e(E),x(()=>{n(Qa,a(c).title),n(Xa,a(c).priority||"no priority"),n(Ya,a(c).source?.type||"unknown source")}),oa("dragstart",E,()=>{o(I,a(c).id)}),p(w,E)}),e(ga),e(b),x(w=>{n(Ga,a(y).label),n(Ka,`${w??""} task(s)`)},[()=>C(a(y).id).length]),oa("dragover",b,w=>w.preventDefault()),oa("drop",b,async()=>{a(I)&&(await ca(a(I),a(y).id,C(a(y).id).length),o(I,""))}),p(_,b)}),e(ka),x(()=>{n(Ba,a(v)?.agentState||"offline"),n(Ja,a(v)?.runtimeOnline?"Runtime online":"Runtime offline"),n(Wa,a(v)?.activeTurns??0),n(ja,`${a(v)?.activeActors??0??""} active actors`),n(qa,a(v)?.openTasks??0),n(Fa,`${a(v)?.overdue??0??""} overdue / ${a(v)?.dueSoon??0??""} due soon`),n(Ha,a(v)?.tokenToday?.total_tokens??0),n(Ua,`Today / Week: ${a(v)?.tokenWeek?.total_tokens??0??""}`)}),Ia(Q,()=>a($),_=>o($,_)),Ia(M,()=>a(D),_=>o(D,_)),lt(A,()=>a(T),_=>o(T,_)),p(s,i)};na(va,s=>{a(J)?s(Ea):s(La,!1)})}var Na=t(va,2);{var Ra=s=>{var i=mt(),l=r(i,!0);e(i),x(()=>n(l,a(u))),p(s,i)};na(Na,s=>{a(u)&&s(Ra)})}e(j),p(Oa,j),et()}export{St as component};
