import{a as v,f as m,t as K,c as Jt}from"../chunks/YeIyPrO1.js";import"../chunks/JjcR20PN.js";import{o as Ht}from"../chunks/7XJTIz-S.js";import{p as Vt,a as zt,s as t,c as o,g as e,r as n,b as s,m as U,f as de,n as F,t as k,j as y}from"../chunks/B28Y1LK0.js";import{d as Gt,s as l}from"../chunks/DrRmIrL_.js";import{i as C}from"../chunks/CSigMgDx.js";import{f as I,p as Z,e as Ze,i as et}from"../chunks/BSTHbYmA.js";import{r as f,B as W,c as Kt,a as Wt}from"../chunks/CTMhrdmY.js";import{a as tt,b as $}from"../chunks/BnWQKn17.js";import{i as Xt}from"../chunks/B5oQgd4i.js";var Yt=m('<p class="muted">Loading...</p>'),Zt=m('<p class="muted">No peers configured.</p>'),ea=m('<p class="error"> </p>'),ta=m('<p class="muted"> </p> <p class="muted"> </p> <!>',1),aa=m('<article class="peer-card"><div class="peer-head"><h4> </h4> <p> </p></div> <p class="muted"> </p> <p><strong>Auth:</strong> </p> <p><strong>Capabilities:</strong> </p> <p><strong>Roles:</strong> </p> <p><strong>Priority/Limits:</strong> </p> <!> <div class="inline"><!> <!> <!> <!></div></article>'),ra=m('<div class="peer-grid"></div>'),ia=m('<p class="muted">No federated runs recorded.</p>'),na=m('<li><button type="button" class="run-link"><strong> </strong> <br/> <span class="muted"> </span></button></li>'),oa=m('<ul class="run-list"></ul>'),sa=m('<p class="muted">Select a run to inspect routing and result details.</p>'),la=m('<p class="error"> </p>'),pa=m('<p class="error"> </p>'),da=m("<li><strong> </strong> <!></li>"),ua=m('<li class="muted">No delivery attempts recorded.</li>'),ca=m('<pre class="run-output"> </pre>'),va=m("<h4>Result</h4> <p> </p> <!> <p><strong>Artifacts:</strong> </p>",1),_a=m('<div class="kv-grid"><p><strong>ID</strong></p> <p> </p> <p><strong>Status</strong></p> <p> </p> <p><strong>Origin</strong></p> <p> </p> <p><strong>Selected Peer</strong></p> <p> </p> <p><strong>Context Mode</strong></p> <p> </p> <p><strong>Created</strong></p> <p> </p> <p><strong>Started</strong></p> <p> </p> <p><strong>Finished</strong></p> <p> </p></div> <p><strong>Fallback Chain:</strong> </p> <!> <h4>Status Timeline</h4> <ul class="run-list"><!></ul> <!>',1),ma=m('<div class="split-grid"><section class="panel"><h3>Node Settings</h3> <label class="checkbox"><input type="checkbox"/> <span>Enable federation</span></label> <label class="checkbox"><input type="checkbox"/> <span>Automatic fallback</span></label> <label for="node-id">Node ID</label> <input id="node-id" name="node_id" type="text"/> <label for="listen-addr">Listen Address</label> <input id="listen-addr" name="listen_addr" type="text"/> <label for="allow-nodes">Allowlist Node IDs (comma separated)</label> <input id="allow-nodes" name="allow_nodes" type="text"/> <label for="request-timeout">Request Timeout (sec)</label> <input id="request-timeout" name="request_timeout" type="number" min="1"/> <label for="max-retries">Max Retries</label> <input id="max-retries" name="max_retries" type="number" min="0"/> <label for="retry-backoff">Retry Backoff (ms)</label> <input id="retry-backoff" name="retry_backoff" type="number" min="0"/> <!></section> <section class="panel"><h3> </h3> <label for="peer-id">Peer ID</label> <input id="peer-id" name="peer_id" type="text"/> <label for="peer-url">Base URL</label> <input id="peer-url" name="peer_url" type="text" placeholder="http://host:port"/> <label for="peer-token"> </label> <input id="peer-token" name="peer_token" type="password"/> <label for="peer-capabilities">Capabilities (comma separated)</label> <input id="peer-capabilities" name="peer_capabilities" type="text"/> <label for="peer-roles">Roles (comma separated)</label> <input id="peer-roles" name="peer_roles" type="text"/> <label for="peer-priority">Priority (lower first)</label> <input id="peer-priority" name="peer_priority" type="number"/> <label for="peer-max-concurrent">Max Concurrent</label> <input id="peer-max-concurrent" name="peer_max_concurrent" type="number" min="1"/> <label for="peer-max-queue">Max Queue</label> <input id="peer-max-queue" name="peer_max_queue" type="number" min="1"/> <label for="peer-health-endpoint">Health Endpoint</label> <input id="peer-health-endpoint" name="peer_health_endpoint" type="text"/> <label class="checkbox"><input type="checkbox"/> <span>Peer enabled</span></label> <div class="inline"><!> <!></div></section></div> <section class="panel"><h3>Configured Peers</h3> <!></section> <section class="split-grid"><section class="panel"><h3>Recent Delegated Runs</h3> <!></section> <section class="panel"><h3>Run Detail</h3> <!></section></section>',1),ba=m('<p class="success" aria-live="polite"> </p>'),fa=m('<p class="error" aria-live="polite"> </p>'),ha=m('<section><header class="page-header"><p class="kicker">Federation</p> <h2>Team / Peers</h2> <p class="muted">Manage peer mesh routing, connectivity, and delegated runs.</p></header> <!> <!> <!></section>');function wa(ft,ht){Vt(ht,!1);const at=()=>({enabled:!1,nodeId:"",listenAddr:"127.0.0.1:18900",requestTimeoutSec:30,maxRetries:2,retryBackoffMs:500,autoFallback:!0,allowFromNodeIDs:[]}),rt=()=>({id:"",baseUrl:"",authToken:"",enabled:!0,capabilities:"",roles:"",priority:100,maxConcurrent:2,maxQueue:64,healthEndpoint:"/api/federation/health"});let ye=U(!0),ge=U(!1),ke=U(!1),h=U(""),S=U(""),u=U(at()),ue=U(""),$e=U([]),it={},Pe=U([]),Te="",_=U(null),N=U(""),i=U(rt());const ee=a=>a.split(",").map(d=>d.trim()).filter(d=>d.length>0),ce=a=>a?new Date(a).toLocaleString():"n/a",j=a=>it[a],nt=a=>{const d=j(a);return d?d.available?"healthy":"unhealthy":"unknown"};async function ot(a){a&&(s(_,await I(`/api/manage/federation/runs/${a}`)),Te=a)}async function X(){s(ye,!0),s(h,"");try{const[a,d,Q]=await Promise.all([I("/api/manage/federation/settings"),I("/api/manage/federation/peers"),I("/api/manage/federation/runs?limit=40")]);s(u,a||at()),s(ue,(e(u).allowFromNodeIDs||[]).join(", ")),s($e,d.peers||[]),it=d.health||{},s(Pe,Q.runs||[]),Te&&await ot(Te)}catch(a){s(h,Z(a))}finally{s(ye,!1)}}async function xt(){s(ge,!0),s(h,""),s(S,"");try{await I("/api/manage/federation/settings",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e(u).enabled,nodeId:e(u).nodeId,listenAddr:e(u).listenAddr,requestTimeoutSec:e(u).requestTimeoutSec,maxRetries:e(u).maxRetries,retryBackoffMs:e(u).retryBackoffMs,autoFallback:e(u).autoFallback,allowFromNodeIDs:ee(e(ue))})}),s(S,"Federation settings saved. Restart runtime to apply changes."),await X()}catch(a){s(h,Z(a))}finally{s(ge,!1)}}function Ce(){s(N,""),s(i,rt())}function yt(a){s(N,a.id),s(i,{id:a.id,baseUrl:a.baseUrl,authToken:"",enabled:a.enabled,capabilities:(a.capabilities||[]).join(", "),roles:(a.roles||[]).join(", "),priority:a.priority,maxConcurrent:a.maxConcurrent,maxQueue:a.maxQueue,healthEndpoint:a.healthEndpoint||"/api/federation/health"})}async function gt(){if(!e(i).id.trim()){s(h,"Peer id is required.");return}if(!e(i).baseUrl.trim()){s(h,"Peer base URL is required.");return}s(ke,!0),s(h,""),s(S,"");try{if(e(N)){const a={baseUrl:e(i).baseUrl.trim(),enabled:e(i).enabled,capabilities:ee(e(i).capabilities),roles:ee(e(i).roles),priority:e(i).priority,maxConcurrent:e(i).maxConcurrent,maxQueue:e(i).maxQueue,healthEndpoint:e(i).healthEndpoint.trim()};e(i).authToken.trim()!==""&&(a.authToken=e(i).authToken.trim()),await I(`/api/manage/federation/peers/${encodeURIComponent(e(N))}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})}else await I("/api/manage/federation/peers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e(i).id.trim(),baseUrl:e(i).baseUrl.trim(),authToken:e(i).authToken.trim(),enabled:e(i).enabled,capabilities:ee(e(i).capabilities),roles:ee(e(i).roles),priority:e(i).priority,maxConcurrent:e(i).maxConcurrent,maxQueue:e(i).maxQueue,healthEndpoint:e(i).healthEndpoint.trim()})});s(S,"Peer saved. Restart runtime to apply changes."),Ce(),await X()}catch(a){s(h,Z(a))}finally{s(ke,!1)}}async function kt(a){s(h,""),s(S,"");try{const d=await I(`/api/manage/federation/peers/${encodeURIComponent(a)}/test`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({originNodeId:e(u).nodeId||"mission-control"})});d.ok?s(S,`Peer ${a} healthy (${d.responseMs??0} ms).`):s(h,d.error||`Peer ${a} test failed.`),await X()}catch(d){s(h,Z(d))}}async function $t(a){s(h,""),s(S,"");try{await I(`/api/manage/federation/peers/${encodeURIComponent(a.id)}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:!a.enabled})}),s(S,`Peer ${a.id} ${a.enabled?"disabled":"enabled"}.`),await X()}catch(d){s(h,Z(d))}}async function Pt(a){s(h,""),s(S,"");try{await I(`/api/manage/federation/peers/${encodeURIComponent(a)}`,{method:"DELETE"}),s(S,`Peer ${a} removed.`),e(N)===a&&Ce(),await X()}catch(d){s(h,Z(d))}}Ht(async()=>{await X()}),Xt();var Se=ha(),st=t(o(Se),2);{var Tt=a=>{var d=Yt();v(a,d)},Ct=a=>{var d=ma(),Q=de(d),Re=o(Q),we=t(o(Re),2),pt=o(we);f(pt),F(2),n(we);var Ee=t(we,2),dt=o(Ee);f(dt),F(2),n(Ee);var Ue=t(Ee,4);f(Ue);var qe=t(Ue,4);f(qe);var Ne=t(qe,4);f(Ne);var Ae=t(Ne,4);f(Ae);var Fe=t(Ae,4);f(Fe);var Ie=t(Fe,4);f(Ie);var Et=t(Ie,2);W(Et,{type:"button",onclick:xt,get disabled(){return e(ge)},children:(r,b)=>{F();var P=K("Save Settings");v(r,P)},$$slots:{default:!0}}),n(Re);var ut=t(Re,2),je=o(ut),Ut=o(je,!0);n(je);var ve=t(je,4);f(ve);var Qe=t(ve,4);f(Qe);var Me=t(Qe,2),qt=o(Me);n(Me);var Be=t(Me,2);f(Be);var De=t(Be,4);f(De);var Oe=t(De,4);f(Oe);var Le=t(Oe,4);f(Le);var Je=t(Le,4);f(Je);var He=t(Je,4);f(He);var Ve=t(He,4);f(Ve);var ze=t(Ve,2),ct=o(ze);f(ct),F(2),n(ze);var vt=t(ze,2),_t=o(vt);W(_t,{type:"button",onclick:gt,get disabled(){return e(ke)},children:(r,b)=>{F();var P=K();k(()=>l(P,e(N)?"Save Peer":"Add Peer")),v(r,P)},$$slots:{default:!0}});var Nt=t(_t,2);W(Nt,{type:"button",onclick:Ce,children:(r,b)=>{F();var P=K("Reset");v(r,P)},$$slots:{default:!0}}),n(vt),n(ut),n(Q);var Ge=t(Q,2),At=t(o(Ge),2);{var Ft=r=>{var b=Zt();v(r,b)},It=r=>{var b=ra();Ze(b,5,()=>e($e),et,(P,p)=>{var M=aa(),q=o(M),B=o(q),H=o(B,!0);n(B);var L=t(B,2),J=o(L,!0);n(L),n(q);var V=t(q,2),te=o(V,!0);n(V);var ae=t(V,2),re=t(o(ae));n(ae);var ie=t(ae,2),ne=t(o(ie));n(ie);var oe=t(ie,2),_e=t(o(oe));n(oe);var se=t(oe,2),le=t(o(se));n(se);var me=t(se,2);{var be=g=>{var A=ta(),c=de(A),x=o(c);n(c);var T=t(c,2),z=o(T);n(T);var R=t(T,2);{var G=w=>{var D=ea(),E=o(D,!0);n(D),k(O=>l(E,O),[()=>j(e(p).id)?.error]),v(w,D)};C(R,w=>{j(e(p).id)?.error&&w(G)})}k((w,D,E,O,pe)=>{l(x,`Queue ${w??""}/${D??""} |
                  Active ${E??""} |
                  RTT ${O??""} ms`),l(z,`Updated: ${pe??""}`)},[()=>j(e(p).id)?.queue_depth??0,()=>j(e(p).id)?.max_queue??e(p).maxQueue,()=>j(e(p).id)?.active_runs??0,()=>j(e(p).id)?.response_time_ms??0,()=>ce(j(e(p).id)?.updated_at)]),v(g,A)};C(me,g=>{j(e(p).id)&&g(be)})}var fe=t(me,2),Y=o(fe);W(Y,{type:"button",onclick:()=>yt(e(p)),children:(g,A)=>{F();var c=K("Edit");v(g,c)},$$slots:{default:!0}});var he=t(Y,2);W(he,{type:"button",onclick:()=>$t(e(p)),children:(g,A)=>{F();var c=K();k(()=>l(c,e(p).enabled?"Disable":"Enable")),v(g,c)},$$slots:{default:!0}});var xe=t(he,2);W(xe,{type:"button",onclick:()=>kt(e(p).id),children:(g,A)=>{F();var c=K("Test");v(g,c)},$$slots:{default:!0}});var We=t(xe,2);W(We,{type:"button",onclick:()=>Pt(e(p).id),children:(g,A)=>{F();var c=K("Delete");v(g,c)},$$slots:{default:!0}}),n(fe),n(M),k((g,A,c,x)=>{l(H,e(p).id),Wt(L,1,g),l(J,A),l(te,e(p).baseUrl),l(re,` ${e(p).authTokenSet?"configured":"not set"}`),l(ne,` ${c??""}`),l(_e,` ${x??""}`),l(le,` ${e(p).priority??""} / ${e(p).maxConcurrent??""} concurrent / ${e(p).maxQueue??""} queue`)},[()=>Kt(nt(e(p).id)==="healthy"?"success":"error"),()=>nt(e(p).id),()=>(e(p).capabilities||[]).join(", ")||"none",()=>(e(p).roles||[]).join(", ")||"none"]),v(P,M)}),n(b),v(r,b)};C(At,r=>{e($e).length===0?r(Ft):r(It,!1)})}n(Ge);var mt=t(Ge,2),Ke=o(mt),jt=t(o(Ke),2);{var Qt=r=>{var b=ia();v(r,b)},Mt=r=>{var b=oa();Ze(b,5,()=>e(Pe),et,(P,p)=>{var M=na(),q=o(M);q.__click=()=>ot(e(p).id);var B=o(q),H=o(B,!0);n(B);var L=t(B),J=t(L,3),V=o(J,!0);n(J),n(q),n(M),k(()=>{l(H,e(p).status),l(L,` / ${e(p).id??""} / ${(e(p).peer_id||"unassigned")??""} `),l(V,e(p).task)}),v(P,M)}),n(b),v(r,b)};C(jt,r=>{e(Pe).length===0?r(Qt):r(Mt,!1)})}n(Ke);var bt=t(Ke,2),Bt=t(o(bt),2);{var Dt=r=>{var b=sa();v(r,b)},Ot=r=>{var b=_a(),P=de(b),p=t(o(P),2),M=o(p,!0);n(p);var q=t(p,4),B=o(q,!0);n(q);var H=t(q,4),L=o(H,!0);n(H);var J=t(H,4),V=o(J,!0);n(J);var te=t(J,4),ae=o(te,!0);n(te);var re=t(te,4),ie=o(re,!0);n(re);var ne=t(re,4),oe=o(ne,!0);n(ne);var _e=t(ne,4),se=o(_e,!0);n(_e),n(P);var le=t(P,2),me=t(o(le));n(le);var be=t(le,2);{var fe=c=>{var x=la(),T=o(x,!0);n(x),k(()=>l(T,e(_).error)),v(c,x)};C(be,c=>{e(_).error&&c(fe)})}var Y=t(be,4),he=o(Y);{var xe=c=>{var x=Jt(),T=de(x);Ze(T,1,()=>e(_).delivery_attempts,et,(z,R)=>{var G=da(),w=o(G),D=o(w,!0);n(w);var E=t(w),O=t(E);{var pe=Xe=>{var Ye=pa(),Lt=o(Ye,!0);n(Ye),k(()=>l(Lt,e(R).error)),v(Xe,Ye)};C(O,Xe=>{e(R).error&&Xe(pe)})}n(G),k(()=>{l(D,e(R).peer_id),l(E,` attempt ${e(R).attempt??""} |
                  status ${(e(R).status_code||0)??""} |
                  ${e(R).retryable?"retryable":"terminal"} |
                  ${e(R).duration_ms??""} ms `)}),v(z,G)}),v(c,x)},We=c=>{var x=ua();v(c,x)};C(he,c=>{e(_).delivery_attempts&&e(_).delivery_attempts.length>0?c(xe):c(We,!1)})}n(Y);var g=t(Y,2);{var A=c=>{var x=va(),T=t(de(x),2),z=o(T,!0);n(T);var R=t(T,2);{var G=E=>{var O=ca(),pe=o(O,!0);n(O),k(()=>l(pe,e(_).result.output)),v(E,O)};C(R,E=>{e(_).result.output&&E(G)})}var w=t(R,2),D=t(o(w));n(w),k(E=>{l(z,e(_).result.summary||"No summary"),l(D,` ${E??""}`)},[()=>(e(_).result.artifact_paths||[]).join(", ")||"none"]),v(c,x)};C(g,c=>{e(_).result&&c(A)})}k((c,x,T,z)=>{l(M,e(_).id),l(B,e(_).status),l(L,e(_).origin_node_id||"n/a"),l(V,e(_).peer_id||"n/a"),l(ae,e(_).context?.mode||"n/a"),l(ie,c),l(oe,x),l(se,T),l(me,` ${z??""}`)},[()=>ce(e(_).created_at),()=>ce(e(_).started_at),()=>ce(e(_).finished_at),()=>(e(_).fallback_chain||[]).join(" -> ")||"none"]),v(r,b)};C(Bt,r=>{e(_)?r(Ot,!1):r(Dt)})}n(bt),n(mt),k(()=>{l(Ut,e(N)?`Edit Peer: ${e(N)}`:"Add Peer"),ve.disabled=e(N)!=="",l(qt,`Auth Token ${e(N)?"(set only to rotate/replace)":""}`)}),tt(pt,()=>e(u).enabled,r=>y(u,e(u).enabled=r)),tt(dt,()=>e(u).autoFallback,r=>y(u,e(u).autoFallback=r)),$(Ue,()=>e(u).nodeId,r=>y(u,e(u).nodeId=r)),$(qe,()=>e(u).listenAddr,r=>y(u,e(u).listenAddr=r)),$(Ne,()=>e(ue),r=>s(ue,r)),$(Ae,()=>e(u).requestTimeoutSec,r=>y(u,e(u).requestTimeoutSec=r)),$(Fe,()=>e(u).maxRetries,r=>y(u,e(u).maxRetries=r)),$(Ie,()=>e(u).retryBackoffMs,r=>y(u,e(u).retryBackoffMs=r)),$(ve,()=>e(i).id,r=>y(i,e(i).id=r)),$(Qe,()=>e(i).baseUrl,r=>y(i,e(i).baseUrl=r)),$(Be,()=>e(i).authToken,r=>y(i,e(i).authToken=r)),$(De,()=>e(i).capabilities,r=>y(i,e(i).capabilities=r)),$(Oe,()=>e(i).roles,r=>y(i,e(i).roles=r)),$(Le,()=>e(i).priority,r=>y(i,e(i).priority=r)),$(Je,()=>e(i).maxConcurrent,r=>y(i,e(i).maxConcurrent=r)),$(He,()=>e(i).maxQueue,r=>y(i,e(i).maxQueue=r)),$(Ve,()=>e(i).healthEndpoint,r=>y(i,e(i).healthEndpoint=r)),tt(ct,()=>e(i).enabled,r=>y(i,e(i).enabled=r)),v(a,d)};C(st,a=>{e(ye)?a(Tt):a(Ct,!1)})}var lt=t(st,2);{var St=a=>{var d=ba(),Q=o(d,!0);n(d),k(()=>l(Q,e(S))),v(a,d)};C(lt,a=>{e(S)&&a(St)})}var Rt=t(lt,2);{var wt=a=>{var d=fa(),Q=o(d,!0);n(d),k(()=>l(Q,e(h))),v(a,d)};C(Rt,a=>{e(h)&&a(wt)})}n(Se),v(ft,Se),zt()}Gt(["click"]);export{wa as component};
