import{a as c,f as y,t as C}from"../chunks/CM07GlJL.js";import"../chunks/D9hnHYOe.js";import{o as ze}from"../chunks/BEG7D-vq.js";import{p as Be,a as Ne,s as i,c as d,g as a,r as p,b as e,m as o,f as je,t as O,i as Ae,n as w}from"../chunks/Cz4rleU9.js";import{d as Ie,s as M}from"../chunks/uqC031GY.js";import{i as U}from"../chunks/C7XFXtUg.js";import{f as P,p as x,e as Je,i as Fe}from"../chunks/dfvWMpTY.js";import{r as _,B as z,b as Ke}from"../chunks/CRPIyqj7.js";import{b,a as Me}from"../chunks/C9t9NGXH.js";import{i as Ue}from"../chunks/iKvBnLVz.js";var Re=y('<p class="muted">Loading...</p>'),Ee=y("<option> </option>"),Le=y('<p class="muted"> </p>'),De=y('<div class="split-grid"><section class="panel"><h3>Provider</h3> <label for="provider-id">Provider</label> <select id="provider-id" name="provider_id"></select> <label for="provider-api-key">API Key</label> <input id="provider-api-key" name="provider_api_key" type="password"/> <label for="provider-api-base">API Base</label> <input id="provider-api-base" name="provider_api_base" type="text"/> <label for="provider-model">Model</label> <input id="provider-model" name="provider_model" type="text"/> <div class="inline"><!> <!></div> <!></section> <section class="panel"><h3>Telegram Channel</h3> <label class="checkbox" for="telegram-enabled"><input id="telegram-enabled" name="telegram_enabled" type="checkbox"/> Enable Telegram</label> <label for="telegram-token">Token</label> <input id="telegram-token" name="telegram_token" type="password"/> <label for="telegram-allow">Allow List (comma-separated)</label> <input id="telegram-allow" name="telegram_allow" type="text"/> <!></section></div> <div class="split-grid"><section class="panel"><h3>Runtime</h3> <label for="heartbeat-interval">Heartbeat Interval (seconds)</label> <input id="heartbeat-interval" name="heartbeat_interval_sec" type="number" min="1"/> <label for="mailbox-size">Mailbox Size</label> <input id="mailbox-size" name="mailbox_size" type="number" min="1"/> <!></section> <section class="panel"><h3>Security</h3> <label for="current-password">Current Password</label> <input id="current-password" name="current_password" type="password"/> <label for="new-password">New Password</label> <input id="new-password" name="new_password" type="password"/> <!></section></div>',1),He=y('<p class="success" aria-live="polite"> </p>'),qe=y('<p class="error" aria-live="polite"> </p>'),Ge=y('<section><header class="page-header"><p class="kicker">Configuration</p> <h2>Settings</h2> <p class="muted">Manage providers, channels, runtime, and security.</p></header> <!> <!> <!></section>');function ia(ve,ce){Be(ce,!1);let R=o(!0),n=o(""),m=o(""),u=o(null),f=o(""),k=o(""),T=o(""),S=o(""),g=o(""),B=o(!1),N=o(""),j=o(""),A=o(1800),I=o(64),J=o(""),F=o("");function te(){const r=a(u)?.providers.items.find(l=>l.id===a(f));e(k,""),e(T,r?.apiBase||""),e(S,r?.model||""),e(g,"")}async function K(){e(R,!0),e(n,""),e(m,"");try{e(u,await P("/api/manage/settings")),e(f,a(u).providers.active||a(u).providers.items[0]?.id||""),te(),e(B,a(u).channels.telegram.enabled),e(j,(a(u).channels.telegram.allowFrom||[]).join(",")),e(A,a(u).runtime.heartbeatIntervalSec||1800),e(I,a(u).runtime.mailboxSize||64)}catch(r){e(n,x(r))}finally{e(R,!1)}}async function me(){e(n,""),e(g,"Testing...");try{const r=await P("/api/manage/settings/provider/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:a(f),apiKey:a(k),apiBase:a(T),model:a(S)})});if(!r.ok){e(g,"Failed"),e(n,r.error||"Provider test failed");return}e(g,"OK")}catch(r){e(g,"Failed"),e(n,x(r))}}async function ue(){e(n,""),e(m,"");try{await P("/api/manage/settings/provider",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:a(f),apiKey:a(k),apiBase:a(T),model:a(S),activate:!0})}),e(m,"Provider settings saved."),await K()}catch(r){e(n,x(r))}}async function _e(){e(n,""),e(m,"");try{await P("/api/manage/settings/channels/telegram",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:a(B),token:a(N),allowFrom:a(j).split(",").map(r=>r.trim()).filter(r=>r.length>0)})}),e(m,"Telegram settings saved."),e(N,""),await K()}catch(r){e(n,x(r))}}async function be(){e(n,""),e(m,"");try{await P("/api/manage/settings/runtime",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({heartbeatIntervalSec:a(A),mailboxSize:a(I)})}),e(m,"Runtime settings saved."),await K()}catch(r){e(n,x(r))}}async function fe(){e(n,""),e(m,"");try{await P("/api/manage/settings/password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:a(J),newPassword:a(F)})}),e(m,"Password updated."),e(J,""),e(F,"")}catch(r){e(n,x(r))}}ze(async()=>{await K()}),Ue();var E=Ge(),re=i(d(E),2);{var ge=r=>{var l=Re();c(r,l)},he=r=>{var l=De(),h=je(l),L=d(h),$=i(d(L),4);O(()=>{a(f),Ae(()=>{a(u)})}),$.__change=()=>{te()},Je($,5,()=>a(u)?.providers.items||[],Fe,(t,v)=>{var s=Ee(),Oe=d(s,!0);p(s);var de={};O(()=>{M(Oe,a(v).label),de!==(de=a(v).id)&&(s.value=(s.__value=a(v).id)??"")}),c(t,s)}),p($);var D=i($,4);_(D);var H=i(D,4);_(H);var q=i(H,4);_(q);var G=i(q,2),se=d(G);z(se,{type:"button",onclick:me,children:(t,v)=>{w();var s=C("Test Provider");c(t,s)},$$slots:{default:!0}});var xe=i(se,2);z(xe,{type:"button",onclick:ue,children:(t,v)=>{w();var s=C("Save Provider");c(t,s)},$$slots:{default:!0}}),p(G);var ke=i(G,2);{var Te=t=>{var v=Le(),s=d(v,!0);p(v),O(()=>M(s,a(g))),c(t,v)};U(ke,t=>{a(g)&&t(Te)})}p(L);var oe=i(L,2),Q=i(d(oe),2),ne=d(Q);_(ne),w(),p(Q);var V=i(Q,4);_(V);var W=i(V,4);_(W);var Se=i(W,2);z(Se,{type:"button",onclick:_e,children:(t,v)=>{w();var s=C("Save Telegram");c(t,s)},$$slots:{default:!0}}),p(oe),p(h);var le=i(h,2),X=d(le),Y=i(d(X),4);_(Y);var Z=i(Y,4);_(Z);var $e=i(Z,2);z($e,{type:"button",onclick:be,children:(t,v)=>{w();var s=C("Save Runtime");c(t,s)},$$slots:{default:!0}}),p(X);var pe=i(X,2),ee=i(d(pe),4);_(ee);var ae=i(ee,4);_(ae);var Ce=i(ae,2);z(Ce,{type:"button",onclick:fe,children:(t,v)=>{w();var s=C("Update Password");c(t,s)},$$slots:{default:!0}}),p(pe),p(le),Ke($,()=>a(f),t=>e(f,t)),b(D,()=>a(k),t=>e(k,t)),b(H,()=>a(T),t=>e(T,t)),b(q,()=>a(S),t=>e(S,t)),Me(ne,()=>a(B),t=>e(B,t)),b(V,()=>a(N),t=>e(N,t)),b(W,()=>a(j),t=>e(j,t)),b(Y,()=>a(A),t=>e(A,t)),b(Z,()=>a(I),t=>e(I,t)),b(ee,()=>a(J),t=>e(J,t)),b(ae,()=>a(F),t=>e(F,t)),c(r,l)};U(re,r=>{a(R)?r(ge):r(he,!1)})}var ie=i(re,2);{var ye=r=>{var l=He(),h=d(l,!0);p(l),O(()=>M(h,a(m))),c(r,l)};U(ie,r=>{a(m)&&r(ye)})}var we=i(ie,2);{var Pe=r=>{var l=qe(),h=d(l,!0);p(l),O(()=>M(h,a(n))),c(r,l)};U(we,r=>{a(n)&&r(Pe)})}p(E),c(ve,E),Ne()}Ie(["change"]);export{ia as component};
