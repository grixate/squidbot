import{a as c,f as h,t as Q}from"../chunks/CM07GlJL.js";import"../chunks/D9hnHYOe.js";import{o as ye}from"../chunks/BEG7D-vq.js";import{p as ke,t as T,a as Se,b as t,c as p,s as n,r as s,g as a,m as l,i as Pe,n as N}from"../chunks/Cz4rleU9.js";import{d as xe,s as F}from"../chunks/uqC031GY.js";import{i as I}from"../chunks/C7XFXtUg.js";import{f as $,p as Te,e as $e,i as Oe}from"../chunks/dfvWMpTY.js";import{r as u,B as V,b as Ce}from"../chunks/CRPIyqj7.js";import{b,a as Be}from"../chunks/C9t9NGXH.js";import{i as Me}from"../chunks/iKvBnLVz.js";import{g as le}from"../chunks/D3Ec_EQC.js";const je=!0,We=Object.freeze(Object.defineProperty({__proto__:null,prerender:je},Symbol.toStringTag,{value:"Module"}));var Ae=h('<section class="panel"><p class="muted">Loading...</p></section>'),Ee=h("<option> </option>"),Ke=h('<section class="panel"><h2>Onboarding</h2> <label for="provider">Provider</label> <select id="provider" name="provider"></select> <label for="api-key">API Key</label> <input id="api-key" name="api_key" type="password" autocomplete="off"/> <label for="api-base">API Base</label> <input id="api-base" name="api_base" type="text" autocomplete="off"/> <label for="model">Model</label> <input id="model" name="model" type="text" autocomplete="off"/> <div class="inline"><!> <span class="result"> </span></div> <hr/> <label class="checkbox" for="telegram-enabled"><input id="telegram-enabled" name="telegram_enabled" type="checkbox"/> Enable Telegram Channel</label> <label for="telegram-token">Telegram Token</label> <input id="telegram-token" name="telegram_token" type="password" autocomplete="off"/> <label for="telegram-allow">Telegram Allow List</label> <input id="telegram-allow" name="telegram_allow" type="text" autocomplete="off"/> <hr/> <label for="password">Management Password (min 12 chars)</label> <input id="password" name="password" type="password" autocomplete="new-password"/> <!></section>'),Le=h('<section class="panel"><h2>Sign In</h2> <label for="login-password">Password</label> <input id="login-password" name="login_password" type="password" autocomplete="current-password"/> <!></section>'),Ne=h('<p class="error" aria-live="polite"> </p>'),Fe=h('<main class="onboarding-shell"><header class="page-header"><p class="kicker">Squidbot</p> <h1>Mission Control Setup</h1> <p class="muted"> </p></header> <!> <!> <!> <!></main>');function Xe(ie,se){ke(se,!1);let m=l("loading"),J=l("Loading setup state..."),w=l(""),O="",y=l([]),v=l(""),C=l(""),f=l(""),g=l(""),B=l(""),k=l(""),M=l(!1),R=l(""),j=l(""),A=l("");const E=()=>t(w,""),K=e=>{t(w,Te(e))};function W(){const e=a(y).find(r=>r.id===a(v));e&&(!a(f)&&e.defaultApiBase&&t(f,e.defaultApiBase),!a(g)&&e.defaultModel&&t(g,e.defaultModel))}async function X(){E(),t(m,"loading");const e=await $("/api/setup/state");if(t(y,e.providers||[]),t(v,e.current?.provider?.id||a(y)[0]?.id||""),t(f,e.current?.provider?.apiBase||""),t(g,e.current?.provider?.model||""),t(M,!!e.current?.channels?.telegram?.enabled),t(j,(e.current?.channels?.telegram?.allowFrom||[]).join(",")),W(),!e.setupComplete){t(m,"onboarding"),t(J,"Complete onboarding to unlock Mission Control.");return}if((await $("/api/auth/session")).authenticated){await le("/app/mission-control");return}t(m,"login"),t(J,"Setup complete. Sign in to continue.")}async function pe(){E(),t(k,"Testing...");try{const e=await $("/api/setup/provider/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:O,provider:a(v),apiKey:a(C),apiBase:a(f),model:a(g)})});if(e.ok){t(k,"OK");return}t(k,"Failed"),t(w,e.error||"Provider test failed")}catch(e){t(k,"Failed"),K(e)}}async function de(){E();try{await $("/api/setup/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:O,provider:a(v),apiKey:a(C),apiBase:a(f),model:a(g),channel:{id:"telegram",enabled:a(M),token:a(R),allowFrom:a(j).split(",").map(r=>r.trim()).filter(r=>r.length>0)},password:a(B)})});const e=new URL(window.location.href);e.searchParams.delete("setup_token"),window.history.replaceState({},"",e.toString()),O="",t(B,""),await X()}catch(e){K(e)}}async function ce(){E();try{await $("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:a(A)})}),t(A,""),await le("/app/mission-control")}catch(e){K(e)}}ye(async()=>{O=new URLSearchParams(window.location.search).get("setup_token")||"";try{await X()}catch(e){K(e),t(m,"loading")}}),Me();var U=Fe(),q=p(U),Y=n(p(q),4),ue=p(Y,!0);s(Y),s(q);var Z=n(q,2);{var me=e=>{var r=Ae();c(e,r)};I(Z,e=>{a(m)==="loading"&&e(me)})}var ee=n(Z,2);{var ve=e=>{var r=Ke(),i=n(p(r),4);T(()=>{a(v),Pe(()=>{a(y)})}),i.__change=W,$e(i,5,()=>a(y),Oe,(o,x)=>{var d=Ee(),we=p(d,!0);s(d);var ne={};T(()=>{F(we,a(x).label),ne!==(ne=a(x).id)&&(d.value=(d.__value=a(x).id)??"")}),c(o,d)}),s(i);var S=n(i,4);u(S);var _=n(S,4);u(_);var L=n(_,4);u(L);var P=n(L,2),te=p(P);V(te,{type:"button",onclick:pe,children:(o,x)=>{N();var d=Q("Test Connection");c(o,d)},$$slots:{default:!0}});var oe=n(te,2),be=p(oe,!0);s(oe),s(P);var z=n(P,4),re=p(z);u(re),N(),s(z);var D=n(z,4);u(D);var G=n(D,4);u(G);var H=n(G,6);u(H);var he=n(H,2);V(he,{type:"button",onclick:de,children:(o,x)=>{N();var d=Q("Complete Setup");c(o,d)},$$slots:{default:!0}}),s(r),T(()=>F(be,a(k))),Ce(i,()=>a(v),o=>t(v,o)),b(S,()=>a(C),o=>t(C,o)),b(_,()=>a(f),o=>t(f,o)),b(L,()=>a(g),o=>t(g,o)),Be(re,()=>a(M),o=>t(M,o)),b(D,()=>a(R),o=>t(R,o)),b(G,()=>a(j),o=>t(j,o)),b(H,()=>a(B),o=>t(B,o)),c(e,r)};I(ee,e=>{a(m)==="onboarding"&&e(ve)})}var ae=n(ee,2);{var fe=e=>{var r=Le(),i=n(p(r),4);u(i);var S=n(i,2);V(S,{type:"button",onclick:ce,children:(_,L)=>{N();var P=Q("Sign In");c(_,P)},$$slots:{default:!0}}),s(r),b(i,()=>a(A),_=>t(A,_)),c(e,r)};I(ae,e=>{a(m)==="login"&&e(fe)})}var ge=n(ae,2);{var _e=e=>{var r=Ne(),i=p(r,!0);s(r),T(()=>F(i,a(w))),c(e,r)};I(ge,e=>{a(w)&&e(_e)})}s(U),T(()=>F(ue,a(J))),c(ie,U),Se()}xe(["change"]);export{Xe as component,We as universal};
