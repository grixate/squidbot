import{a as n,f as v,t as I}from"../chunks/BEu3xU8X.js";import"../chunks/BKxQFQd5.js";import{o as pe}from"../chunks/Vc4QFieL.js";import{p as fe,l as de,e as me,a as ve,g as e,b as r,s as l,c,r as i,m as f,n as N,u as O,h as ue,t as G}from"../chunks/BTMJvSec.js";import{s as R}from"../chunks/Bcgy8Ni5.js";import{i as B}from"../chunks/CcCxq7f-.js";import{p as D,f as S,r as _e,B as E,s as he,e as ye,i as ge}from"../chunks/C6q300kx.js";import{b as H}from"../chunks/l2SKR2qa.js";import{i as be}from"../chunks/DlHN4S8Y.js";import{S as xe}from"../chunks/DWSVT9GM.js";var $e=v('<p class="muted">Loading…</p>'),Se=v('<p class="muted">No results yet.</p>'),we=v("<li><p><strong> </strong></p> <p> </p></li>"),ke=v('<ul class="memory-results"></ul>'),Fe=v('<div class="split-grid"><section class="panel"><h3>Search Memory</h3> <label for="query">Query</label> <input id="query" name="memory_query" type="text" autocomplete="off" placeholder="Search memory snippets…"/> <!> <!></section> <section class="panel"><h3>Curated Editor</h3> <label for="file-select">File</label> <!> <label for="file-content">Content</label> <textarea id="file-content" name="memory_content"></textarea> <div class="inline"><!> <!></div></section></div>'),qe=v('<p class="error" aria-live="polite"> </p>'),Ce=v('<section><header class="page-header"><p class="kicker">Knowledge</p> <h2>Memory</h2> <p class="muted">Search indexed memory and edit curated markdown files.</p></header> <!> <!></section>');function Le(V,W){fe(W,!1);let w=f(!0),d=f(""),h=[],o=f(""),y=f(""),g="",b=f(""),u=f([]),J=f([]),k=f("");async function X(){h=(await S("/api/manage/files")).files||[],r(J,h.map(s=>({value:s.id,label:s.label}))),!e(o)&&h.length>0&&(r(o,h[0].id),await F())}async function F(){if(!e(o))return;const t=await S(`/api/manage/files?id=${e(o)}`);r(y,t.content||""),g=t.etag||""}async function Y(){if(e(o)){r(d,"");try{g=(await S(`/api/manage/files/${e(o)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:e(y),etag:g})})).etag||g}catch(t){r(d,D(t))}}}async function Z(){r(d,"");try{if(!e(b).trim()){r(u,[]);return}const t=await S(`/api/manage/memory/search?q=${encodeURIComponent(e(b))}`);r(u,t.results||[])}catch(t){r(d,D(t))}}pe(async()=>{r(w,!0);try{await X()}catch(t){r(d,D(t))}finally{r(w,!1)}}),de(()=>(e(o),e(k)),()=>{e(o)&&e(o)!==e(k)&&(r(k,e(o)),F())}),me(),be();var q=Ce(),L=l(c(q),2);{var ee=t=>{var s=$e();n(t,s)},te=t=>{var s=Fe(),_=c(s),C=l(c(_),4);_e(C);var T=l(C,2);E(T,{type:"button",onclick:Z,children:(a,p)=>{N();var m=I("Search");n(a,m)},$$slots:{default:!0}});var oe=l(T,2);{var se=a=>{var p=Se();n(a,p)},le=a=>{var p=ke();ye(p,5,()=>e(u),ge,(m,$)=>{var M=we(),P=c(M),z=c(P),ne=c(z,!0);i(z),i(P);var A=l(P,2),ce=c(A,!0);i(A),i(M),G(()=>{R(ne,(e($),O(()=>e($).path))),R(ce,(e($),O(()=>e($).content)))}),n(m,M)}),i(p),n(a,p)};B(oe,a=>{e(u),O(()=>e(u).length===0)?a(se):a(le,!1)})}i(_);var U=l(_,2),j=l(c(U),4);xe(j,{id:"file-select",name:"memory_file",get options(){return e(J)},ariaLabel:"Memory file",placeholder:"Select file…",get value(){return e(o)},set value(a){r(o,a)},$$legacy:!0});var x=l(j,4);ue(x),he(x,"rows",18);var K=l(x,2),Q=c(K);E(Q,{type:"button",onclick:Y,children:(a,p)=>{N();var m=I("Save");n(a,m)},$$slots:{default:!0}});var ie=l(Q,2);E(ie,{type:"button",onclick:F,children:(a,p)=>{N();var m=I("Reload");n(a,m)},$$slots:{default:!0}}),i(K),i(U),i(s),H(C,()=>e(b),a=>r(b,a)),H(x,()=>e(y),a=>r(y,a)),n(t,s)};B(L,t=>{e(w)?t(ee):t(te,!1)})}var ae=l(L,2);{var re=t=>{var s=qe(),_=c(s,!0);i(s),G(()=>R(_,e(d))),n(t,s)};B(ae,t=>{e(d)&&t(re)})}i(q),n(V,q),ve()}export{Le as component};
