import{a as v,f,t as F}from"../chunks/YeIyPrO1.js";import"../chunks/JjcR20PN.js";import{o as Re}from"../chunks/7XJTIz-S.js";import{p as De,a as Le,s as r,c,g as e,r as d,b as a,m as o,f as He,t as k,i as ge,n as x}from"../chunks/B28Y1LK0.js";import{d as qe,s as N}from"../chunks/DrRmIrL_.js";import{i as q}from"../chunks/CSigMgDx.js";import{f as S,p as $,e as we,i as Pe}from"../chunks/BSTHbYmA.js";import{r as h,B as J,b as ke}from"../chunks/CTMhrdmY.js";import{b as _,a as Ge}from"../chunks/BnWQKn17.js";import{i as Qe}from"../chunks/B5oQgd4i.js";var Ve=f('<p class="muted">Loading...</p>'),We=f("<option> </option>"),Xe=f('<p class="muted"> </p>'),Ye=f("<option> </option>"),Ze=f('<div class="split-grid"><section class="panel"><h3>Provider</h3> <label for="provider-id">Provider</label> <select id="provider-id" name="provider_id"></select> <label for="provider-api-key">API Key</label> <input id="provider-api-key" name="provider_api_key" type="password"/> <label for="provider-api-base">API Base</label> <input id="provider-api-base" name="provider_api_base" type="text"/> <label for="provider-model">Model</label> <input id="provider-model" name="provider_model" type="text"/> <div class="inline"><!> <!></div> <!></section> <section class="panel"><h3>Channel</h3> <label for="channel-id">Channel</label> <select id="channel-id" name="channel_id"></select> <label class="checkbox" for="channel-enabled"><input id="channel-enabled" name="channel_enabled" type="checkbox"/> Enable Channel</label> <label for="channel-token">Token</label> <input id="channel-token" name="channel_token" type="password"/> <label for="channel-allow">Allow List (comma-separated)</label> <input id="channel-allow" name="channel_allow" type="text"/> <label for="channel-endpoint">Endpoint</label> <input id="channel-endpoint" name="channel_endpoint" type="text"/> <label for="channel-auth">Auth Token</label> <input id="channel-auth" name="channel_auth" type="password"/> <!></section></div> <div class="split-grid"><section class="panel"><h3>Runtime</h3> <label for="heartbeat-interval">Heartbeat Interval (seconds)</label> <input id="heartbeat-interval" name="heartbeat_interval_sec" type="number" min="1"/> <label for="mailbox-size">Mailbox Size</label> <input id="mailbox-size" name="mailbox_size" type="number" min="1"/> <!></section> <section class="panel"><h3>Security</h3> <label for="current-password">Current Password</label> <input id="current-password" name="current_password" type="password"/> <label for="new-password">New Password</label> <input id="new-password" name="new_password" type="password"/> <!></section></div>',1),ea=f('<p class="success" aria-live="polite"> </p>'),aa=f('<p class="error" aria-live="polite"> </p>'),ta=f('<section><header class="page-header"><p class="kicker">Configuration</p> <h2>Settings</h2> <p class="muted">Manage providers, channels, runtime, and security.</p></header> <!> <!> <!></section>');function ua(xe,Se){De(Se,!1);let G=o(!0),p=o(""),m=o(""),u=o(null),y=o(""),T=o(""),C=o(""),O=o(""),g=o(""),b=o([]),w=o("telegram"),E=o(!1),A=o(""),K=o(""),M=o(""),I=o(""),U=o(1800),R=o(64),D=o(""),L=o("");function ce(){const n=e(u)?.providers.items.find(s=>s.id===e(y));a(T,""),a(C,n?.apiBase||""),a(O,n?.model||""),a(g,"")}async function H(){a(G,!0),a(p,""),a(m,"");try{a(u,await S("/api/manage/settings")),a(y,e(u).providers.active||e(u).providers.items[0]?.id||""),ce(),a(b,Object.values(e(u).channels.items||{})),e(b).length===0&&a(b,[{id:"telegram",label:"Telegram",kind:"core",enabled:e(u).channels.telegram.enabled,tokenSet:e(u).channels.telegram.tokenSet,allowFrom:e(u).channels.telegram.allowFrom||[]}]),a(w,e(b).find(n=>n.id==="telegram")?.id||e(b)[0]?.id||"telegram"),ve(),a(U,e(u).runtime.heartbeatIntervalSec||1800),a(R,e(u).runtime.mailboxSize||64)}catch(n){a(p,$(n))}finally{a(G,!1)}}async function $e(){a(p,""),a(g,"Testing...");try{const n=await S("/api/manage/settings/provider/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e(y),apiKey:e(T),apiBase:e(C),model:e(O)})});if(!n.ok){a(g,"Failed"),a(p,n.error||"Provider test failed");return}a(g,"OK")}catch(n){a(g,"Failed"),a(p,$(n))}}async function Te(){a(p,""),a(m,"");try{await S("/api/manage/settings/provider",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({provider:e(y),apiKey:e(T),apiBase:e(C),model:e(O),activate:!0})}),a(m,"Provider settings saved."),await H()}catch(n){a(p,$(n))}}function ve(){const n=e(b).find(s=>s.id===e(w));n&&(a(E,!!n.enabled),a(A,""),a(K,(n.allowFrom||[]).join(",")),a(M,n.endpoint||""),a(I,""))}async function Ce(){a(p,""),a(m,"");try{await S(`/api/manage/settings/channels/${e(w)}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({enabled:e(E),token:e(A),allowFrom:e(K).split(",").map(n=>n.trim()).filter(n=>n.length>0),endpoint:e(M),authToken:e(I)})}),a(m,`Channel settings saved for ${e(w)}.`),a(A,""),a(I,""),await H()}catch(n){a(p,$(n))}}async function Oe(){a(p,""),a(m,"");try{await S("/api/manage/settings/runtime",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({heartbeatIntervalSec:e(U),mailboxSize:e(R)})}),a(m,"Runtime settings saved."),await H()}catch(n){a(p,$(n))}}async function Ae(){a(p,""),a(m,"");try{await S("/api/manage/settings/password",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({currentPassword:e(D),newPassword:e(L)})}),a(m,"Password updated."),a(D,""),a(L,"")}catch(n){a(p,$(n))}}Re(async()=>{await H()}),Qe();var Q=ta(),ue=r(c(Q),2);{var Ie=n=>{var s=Ve();v(n,s)},je=n=>{var s=Ze(),P=He(s),V=c(P),j=r(c(V),4);k(()=>{e(y),ge(()=>{e(u)})}),j.__change=()=>{ce()},we(j,5,()=>e(u)?.providers.items||[],Pe,(t,l)=>{var i=We(),pe=c(i,!0);d(i);var B={};k(()=>{N(pe,e(l).label),B!==(B=e(l).id)&&(i.value=(i.__value=e(l).id)??"")}),v(t,i)}),d(j);var W=r(j,4);h(W);var X=r(W,4);h(X);var Y=r(X,4);h(Y);var Z=r(Y,2),me=c(Z);J(me,{type:"button",onclick:$e,children:(t,l)=>{x();var i=F("Test Provider");v(t,i)},$$slots:{default:!0}});var Ne=r(me,2);J(Ne,{type:"button",onclick:Te,children:(t,l)=>{x();var i=F("Save Provider");v(t,i)},$$slots:{default:!0}}),d(Z);var Je=r(Z,2);{var Ee=t=>{var l=Xe(),i=c(l,!0);d(l),k(()=>N(i,e(g))),v(t,l)};q(Je,t=>{e(g)&&t(Ee)})}d(V);var _e=r(V,2),z=r(c(_e),4);k(()=>{e(w),ge(()=>{e(b)})}),z.__change=()=>{ve()},we(z,5,()=>e(b),Pe,(t,l)=>{var i=Ye(),pe=c(i);d(i);var B={};k(()=>{N(pe,`${e(l).label??""} (${e(l).kind??""})`),B!==(B=e(l).id)&&(i.value=(i.__value=e(l).id)??"")}),v(t,i)}),d(z);var ee=r(z,2),be=c(ee);h(be),x(),d(ee);var ae=r(ee,4);h(ae);var te=r(ae,4);h(te);var ne=r(te,4);h(ne);var re=r(ne,4);h(re);var Ke=r(re,2);J(Ke,{type:"button",onclick:Ce,children:(t,l)=>{x();var i=F("Save Channel");v(t,i)},$$slots:{default:!0}}),d(_e),d(P);var fe=r(P,2),ie=c(fe),oe=r(c(ie),4);h(oe);var le=r(oe,4);h(le);var Me=r(le,2);J(Me,{type:"button",onclick:Oe,children:(t,l)=>{x();var i=F("Save Runtime");v(t,i)},$$slots:{default:!0}}),d(ie);var ye=r(ie,2),se=r(c(ye),4);h(se);var de=r(se,4);h(de);var Ue=r(de,2);J(Ue,{type:"button",onclick:Ae,children:(t,l)=>{x();var i=F("Update Password");v(t,i)},$$slots:{default:!0}}),d(ye),d(fe),ke(j,()=>e(y),t=>a(y,t)),_(W,()=>e(T),t=>a(T,t)),_(X,()=>e(C),t=>a(C,t)),_(Y,()=>e(O),t=>a(O,t)),ke(z,()=>e(w),t=>a(w,t)),Ge(be,()=>e(E),t=>a(E,t)),_(ae,()=>e(A),t=>a(A,t)),_(te,()=>e(K),t=>a(K,t)),_(ne,()=>e(M),t=>a(M,t)),_(re,()=>e(I),t=>a(I,t)),_(oe,()=>e(U),t=>a(U,t)),_(le,()=>e(R),t=>a(R,t)),_(se,()=>e(D),t=>a(D,t)),_(de,()=>e(L),t=>a(L,t)),v(n,s)};q(ue,n=>{e(G)?n(Ie):n(je,!1)})}var he=r(ue,2);{var ze=n=>{var s=ea(),P=c(s,!0);d(s),k(()=>N(P,e(m))),v(n,s)};q(he,n=>{e(m)&&n(ze)})}var Be=r(he,2);{var Fe=n=>{var s=aa(),P=c(s,!0);d(s),k(()=>N(P,e(p))),v(n,s)};q(Be,n=>{e(p)&&n(Fe)})}d(Q),v(xe,Q),Le()}qe(["change"]);export{ua as component};
