import{a as v,f as x,t as ee}from"../chunks/YeIyPrO1.js";import"../chunks/JjcR20PN.js";import{o as Ae}from"../chunks/7XJTIz-S.js";import{p as Ee,t as T,a as Fe,b as o,c as f,s as r,r as m,g as e,j as S,m as u,i as Ke,n as te,f as Le}from"../chunks/B28Y1LK0.js";import{d as Ne,s as P}from"../chunks/DrRmIrL_.js";import{i as Q}from"../chunks/CSigMgDx.js";import{f as L,p as Ie,e as _e,i as be}from"../chunks/BSTHbYmA.js";import{r as _,B as ae,b as Je,s as p}from"../chunks/CTMhrdmY.js";import{b as g,a as Re}from"../chunks/BnWQKn17.js";import{i as Ue}from"../chunks/B5oQgd4i.js";import{g as ge}from"../chunks/DopsYc3A.js";const qe=!0,st=Object.freeze(Object.defineProperty({__proto__:null,prerender:qe},Symbol.toStringTag,{value:"Module"}));var ze=x('<section class="panel"><p class="muted">Loading...</p></section>'),De=x("<option> </option>"),Ge=x('<h3> </h3> <label class="checkbox"><input type="checkbox"/> </label> <label>Token</label> <input type="password" autocomplete="off"/> <label>Allow List</label> <input type="text" autocomplete="off"/> <label>Endpoint</label> <input type="text" autocomplete="off"/> <label>Auth Token</label> <input type="password" autocomplete="off"/>',1),He=x('<section class="panel"><h2>Onboarding</h2> <label for="provider">Provider</label> <select id="provider" name="provider"></select> <label for="api-key">API Key</label> <input id="api-key" name="api_key" type="password" autocomplete="off"/> <label for="api-base">API Base</label> <input id="api-base" name="api_base" type="text" autocomplete="off"/> <label for="model">Model</label> <input id="model" name="model" type="text" autocomplete="off"/> <div class="inline"><!> <span class="result"> </span></div> <hr/> <!> <hr/> <label for="password">Management Password (min 12 chars)</label> <input id="password" name="password" type="password" autocomplete="new-password"/> <!></section>'),Qe=x('<section class="panel"><h2>Sign In</h2> <label for="login-password">Password</label> <input id="login-password" name="login_password" type="password" autocomplete="current-password"/> <!></section>'),Ve=x('<p class="error" aria-live="polite"> </p>'),We=x('<main class="onboarding-shell"><header class="page-header"><p class="kicker">Squidbot</p> <h1>Mission Control Setup</h1> <p class="muted"> </p></header> <!> <!> <!> <!></main>');function pt(he,we){Ee(we,!1);let h=u("loading"),V=u("Loading setup state..."),O=u(""),N="",B=u([]),w=u(""),I=u(""),y=u(""),k=u(""),J=u(""),C=u(""),W=u([]),i=u({}),R=u("");const U=()=>o(O,""),q=t=>{o(O,Ie(t))};function oe(){const t=e(B).find(n=>n.id===e(w));t&&(!e(y)&&t.defaultApiBase&&o(y,t.defaultApiBase),!e(k)&&t.defaultModel&&o(k,t.defaultModel))}async function re(){U(),o(h,"loading");const t=await L("/api/setup/state");o(B,t.providers||[]),o(w,t.current?.provider?.id||e(B)[0]?.id||""),o(y,t.current?.provider?.apiBase||""),o(k,t.current?.provider?.model||""),o(W,t.channels||[]),o(i,{});for(const l of e(W)){const d=t.current?.channels?.[l.id]||{};S(i,e(i)[l.id]={enabled:!!d.enabled,token:"",allow:(d.allowFrom||[]).join(","),endpoint:d.endpoint||"",authToken:""})}if(e(i).telegram||S(i,e(i).telegram={enabled:!1,token:"",allow:"",endpoint:"",authToken:""}),oe(),!t.setupComplete){o(h,"onboarding"),o(V,"Complete onboarding to unlock Mission Control.");return}if((await L("/api/auth/session")).authenticated){await ge("/app/mission-control");return}o(h,"login"),o(V,"Setup complete. Sign in to continue.")}async function ye(){U(),o(C,"Testing...");try{const t=await L("/api/setup/provider/test",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:N,provider:e(w),apiKey:e(I),apiBase:e(y),model:e(k)})});if(t.ok){o(C,"OK");return}o(C,"Failed"),o(O,t.error||"Provider test failed")}catch(t){o(C,"Failed"),q(t)}}async function ke(){U();try{await L("/api/setup/complete",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({setupToken:N,provider:e(w),apiKey:e(I),apiBase:e(y),model:e(k),channels:Object.entries(e(i)).map(([n,l])=>({id:n,enabled:l.enabled,token:l.token,allowFrom:l.allow.split(",").map(d=>d.trim()).filter(d=>d.length>0),endpoint:l.endpoint,authToken:l.authToken})),channel:{id:"telegram",enabled:e(i).telegram?.enabled||!1,token:e(i).telegram?.token||"",allowFrom:(e(i).telegram?.allow||"").split(",").map(n=>n.trim()).filter(n=>n.length>0)},password:e(J)})});const t=new URL(window.location.href);t.searchParams.delete("setup_token"),window.history.replaceState({},"",t.toString()),N="",o(J,""),await re()}catch(t){q(t)}}async function $e(){U();try{await L("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({password:e(R)})}),o(R,""),await ge("/app/mission-control")}catch(t){q(t)}}Ae(async()=>{N=new URLSearchParams(window.location.search).get("setup_token")||"";try{await re()}catch(t){q(t),o(h,"loading")}}),Ue();var X=We(),Y=f(X),ie=r(f(Y),4),Se=f(ie,!0);m(ie),m(Y);var ne=r(Y,2);{var xe=t=>{var n=ze();v(t,n)};Q(ne,t=>{e(h)==="loading"&&t(xe)})}var le=r(ne,2);{var Te=t=>{var n=He(),l=r(f(n),4);T(()=>{e(w),Ke(()=>{e(B)})}),l.__change=oe,_e(l,5,()=>e(B),be,(s,a)=>{var c=De(),M=f(c,!0);m(c);var D={};T(()=>{P(M,e(a).label),D!==(D=e(a).id)&&(c.value=(c.__value=e(a).id)??"")}),v(s,c)}),m(l);var d=r(l,4);_(d);var $=r(d,4);_($);var z=r($,4);_(z);var j=r(z,2),pe=f(j);ae(pe,{type:"button",onclick:ye,children:(s,a)=>{te();var c=ee("Test Connection");v(s,c)},$$slots:{default:!0}});var de=r(pe,2),Ce=f(de,!0);m(de),m(j);var ue=r(j,4);_e(ue,1,()=>e(W),be,(s,a)=>{var c=Ge(),M=Le(c),D=f(M,!0);m(M);var G=r(M,2),A=f(G);_(A);var Me=r(A);m(G);var ce=r(G,2),E=r(ce,2);_(E);var me=r(E,2),F=r(me,2);_(F);var fe=r(F,2),K=r(fe,2);_(K);var ve=r(K,2),H=r(ve,2);_(H),T(()=>{P(D,e(a).label),p(G,"for",`channel-enabled-${e(a).id}`),p(A,"id",`channel-enabled-${e(a).id}`),p(A,"name",`channel_enabled_${e(a).id}`),P(Me,` Enable ${e(a).label??""}`),p(ce,"for",`channel-token-${e(a).id}`),p(E,"id",`channel-token-${e(a).id}`),p(E,"name",`channel_token_${e(a).id}`),p(me,"for",`channel-allow-${e(a).id}`),p(F,"id",`channel-allow-${e(a).id}`),p(F,"name",`channel_allow_${e(a).id}`),p(fe,"for",`channel-endpoint-${e(a).id}`),p(K,"id",`channel-endpoint-${e(a).id}`),p(K,"name",`channel_endpoint_${e(a).id}`),p(ve,"for",`channel-auth-${e(a).id}`),p(H,"id",`channel-auth-${e(a).id}`),p(H,"name",`channel_auth_${e(a).id}`)}),Re(A,()=>e(i)[e(a).id].enabled,b=>S(i,e(i)[e(a).id].enabled=b)),g(E,()=>e(i)[e(a).id].token,b=>S(i,e(i)[e(a).id].token=b)),g(F,()=>e(i)[e(a).id].allow,b=>S(i,e(i)[e(a).id].allow=b)),g(K,()=>e(i)[e(a).id].endpoint,b=>S(i,e(i)[e(a).id].endpoint=b)),g(H,()=>e(i)[e(a).id].authToken,b=>S(i,e(i)[e(a).id].authToken=b)),v(s,c)});var Z=r(ue,6);_(Z);var je=r(Z,2);ae(je,{type:"button",onclick:ke,children:(s,a)=>{te();var c=ee("Complete Setup");v(s,c)},$$slots:{default:!0}}),m(n),T(()=>P(Ce,e(C))),Je(l,()=>e(w),s=>o(w,s)),g(d,()=>e(I),s=>o(I,s)),g($,()=>e(y),s=>o(y,s)),g(z,()=>e(k),s=>o(k,s)),g(Z,()=>e(J),s=>o(J,s)),v(t,n)};Q(le,t=>{e(h)==="onboarding"&&t(Te)})}var se=r(le,2);{var Pe=t=>{var n=Qe(),l=r(f(n),4);_(l);var d=r(l,2);ae(d,{type:"button",onclick:$e,children:($,z)=>{te();var j=ee("Sign In");v($,j)},$$slots:{default:!0}}),m(n),g(l,()=>e(R),$=>o(R,$)),v(t,n)};Q(se,t=>{e(h)==="login"&&t(Pe)})}var Oe=r(se,2);{var Be=t=>{var n=Ve(),l=f(n,!0);m(n),T(()=>P(l,e(O))),v(t,n)};Q(Oe,t=>{e(O)&&t(Be)})}m(X),T(()=>P(Se,e(V))),v(he,X),Fe()}Ne(["change"]);export{pt as component,st as universal};
